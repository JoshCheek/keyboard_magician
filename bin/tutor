#!/usr/bin/env ruby

# THIS IS ALL UNTESTED
$LOAD_PATH.unshift File.expand_path '../../lib', __FILE__

require 'interpret_character'
require 'tutor'

system "stty raw"

begin
  target_string = 'abc def'
  timer         = Timer.new
  user_input    = UserInput.new []
  characters    = []

  timer.start
  game_stats = nil

  loop do
    game_stats = GameStats.new target_string: target_string,
                               input_string:  user_input.to_s,
                               timer:         timer
    break if game_stats.over?
    raw_char   = InterpretCharacter.call($stdin.getc)
    characters << Character.new(*raw_char )
    user_input = UserInput.new characters
  end

  timer.stop
ensure
  system "stty -raw"
end

puts "Game Stats"
puts "=========="
puts "time taken:            #{game_stats.seconds_taken.inspect}"
puts "characters per second: #{game_stats.cps}"
puts "num errors:            #{game_stats.num_errors}"
